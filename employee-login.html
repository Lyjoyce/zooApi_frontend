<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Connexion Employé – Autruche & Compagnie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/employee-login.css">
</head>

<body>
  <div class="login-container">
    <div class="login-box">
      <a href="index.html" class="logo-home-link">
        <img src="images/3.png" alt="Logo Ostrich Farmer" class="logo">
      </a>
      <h1>Connexion Employé</h1>
      <form id="employeeLoginForm">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" required autocomplete="username">

        <label for="password">Mot de passe</label>
        <input type="password" id="password" name="password" required autocomplete="current-password">

        <button type="submit">Se connecter</button>
      </form>
      <p class="footer-note">Accès réservé aux employés, vétérinaires et administrateurs.
        <a href="privacy-policy.html">Politique de confidentialité</a>
      </p>
    </div>
  </div>

  <script>
    // Vérifie que le formulaire et les inputs existent
    const form = document.getElementById('employeeLoginForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    if (!form || !emailInput || !passwordInput) {
      console.error("Un ou plusieurs éléments du formulaire n'ont pas été trouvés !");
    } else {
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = emailInput.value.trim();
        const password = passwordInput.value;

        if (!email || !password) {
          alert("Veuillez remplir tous les champs !");
          return;
        }

        const BASE_URL = 'https://zooapi-autruche.onrender.com';

        try {
          const response = await fetch(`${BASE_URL}/api/v1/employees/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password })
          });

          if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            alert(errorData.message || "Échec de la connexion. Vérifiez vos identifiants.");
            return;
          }

          const data = await response.json();

          if (!data.role || !data.firstName || !data.lastName) {
            alert("Réponse du serveur inattendue.");
            console.error("Données serveur :", data);
            return;
          }

          alert(`Bienvenue ${data.firstName} ${data.lastName} (${data.role})`);

          // Redirection conditionnelle selon le rôle
          switch (data.role.toUpperCase()) {
            case 'EMPLOYEE':
              window.location.href = '/zooApi_frontend/dashboard-employee.html';
              break;
            case 'VETERINAIRE':
              window.location.href = '/zooApi_frontend/dashboard-veterinaire.html';
              break;
            default:
              window.location.href = '/zooApi_frontend/dashboard.html';
          }

        } catch (error) {
          console.error("Erreur lors de la connexion :", error);
          alert("Erreur lors de la tentative de connexion. Vérifiez votre connexion ou le serveur.");
        }
      });
    }
  </script>

  <!--<script src="js/employee-login.js"></script>-->
</body>
</html>